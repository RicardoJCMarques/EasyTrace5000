# Enable rewrite engine
RewriteEngine On

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://cam.eltryus.design/$1 [R=301,L]

# MIME types
<IfModule mod_mime.c>
    AddType text/javascript .js
    AddType application/wasm .wasm
    AddType application/json .json
    AddType application/manifest+json .webmanifest
    AddType image/svg+xml .svg
    AddType image/x-icon .ico
</IfModule>

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/css text/javascript application/javascript application/json application/wasm image/svg+xml
</IfModule>

# Security headers & Caching
<IfModule mod_headers.c>
    # Security
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    
    # --- CACHING STRATEGY ---

    # GROUP 1: Code & Logic (The "Safe" Group)
    # Includes: HTML, CSS, JS, JSON
    # Action: Browser must check with server every time (0 latency if unchanged).
    # Prevents "stale code" issues.
    <FilesMatch "\.(html|css|js|mjs|json)$">
        Header set Cache-Control "no-cache, must-revalidate"
    </FilesMatch>

    # GROUP 2: Heavy Binaries & Assets (The "Fast" Group)
    # Includes: WASM, Images
    # Action: Cache for 1 month. 
    # Assumption: These change rarely.
    <FilesMatch "\.(wasm|png|jpg|jpeg|gif|webp|svg|ico)$">
        Header set Cache-Control "public, max-age=2592000, immutable"
    </FilesMatch>

</IfModule>

# Directory and file handling
DirectoryIndex index.html
Options -MultiViews -Indexes

# Clean URLs
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{THE_REQUEST} \s/+([^/]+)\.html[\s?] [NC]
RewriteRule ^(.+)\.html$ /$1 [R=301,L]

RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^([^\.]+)$ $1.html [NC,L]