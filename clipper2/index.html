<!--
/**
 * @file        index.html
 * @description EasyTrace5000 Clipper2 Test Suite Entry Point
 * @author      Eltryus - Ricardo Marques
 * @copyright   2025-2026 Eltryus - Ricardo Marques
 * @see         {@link https://github.com/RicardoJCMarques/EasyTrace5000}
 * @license     AGPL-3.0-or-later
 */

/*
 * EasyTrace5000 - Advanced PCB Isolation CAM Workspace
 * Copyright (C) 2025-2026 Eltryus
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clipper2 WASM Test Suite</title>
    <link rel="stylesheet" href="clipper2testpage.css">
</head>
<body>
    <div class="container">
        <h1>
            Clipper2 WASM Test Suite
            <span class="version-badge">v1.1</span>
        </h1>

        <p class="welcome-message">
            This page provides an interactive syntax demonstration of the <strong>Clipper2</strong> library compiled to <strong>WASM (WebAssembly)</strong>.
        </p>


        <!-- Core Boolean Operations -->
        <h2 class="test-group-header">Core Boolean Operations</h2>

        <div class="test-grid">
            <!-- Boolean Operations Test -->
            <div class="test-card" data-test="boolean">
                <div class="test-header">
                    <h3 class="test-title">Boolean Operations</h3>
                </div>
                <p class="test-description">Test union, intersection, difference, and XOR operations with draggable shapes</p>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="boolean-canvas" width="800" height="800"></canvas>
                    </div>
                    <div class="controls-panel">
                        <div class="controls">
                            <div class="control">
                                <label for="boolean-operation">Operation:</label>
                                <select id="boolean-operation">
                                    <option value="union">Union</option>
                                    <option value="intersection">Intersection</option>
                                    <option value="difference">Difference</option>
                                    <option value="xor">XOR</option>
                                </select>
                            </div>
                            <div class="control">
                                <label for="boolean-clip-shape">Clip Shape:</label>
                                <select id="boolean-clip-shape">
                                    <option value="circle">Circle</option>
                                    <option value="triangle">Triangle</option>
                                    <option value="square">Square</option>
                                    <option value="star">Star</option>
                                    <option value="random">Random</option>
                                    <option value="rabbit">Rabbit (SVG)</option>
                                </select>
                            </div>
                        </div>

                        <div class="controls">
                            <button class="btn btn-primary" onclick="tests.testBooleanOperation()">Run Operation</button>
                            <button class="btn btn-secondary" onclick="tests.resetTest('boolean')">Reset</button>
                        </div>

                        <div class="controls">
                            <button class="btn btn-success" onclick="tests.exportSVG('boolean', 'raw')">Export Raw</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('boolean', 'input')">Export Input</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('boolean', 'output')">Export Output</button>
                        </div>
                        
                        <div id="boolean-result" class="result">Ready to run test</div>
                        <div id="boolean-info" class="geometry-info"></div>
                    </div>
                </div>
            </div>

            <!-- Letter B Test -->
            <div class="test-card" data-test="letter-b">
                <div class="test-header">
                    <h3 class="test-title">Letter B Creation<span class="badge">Hole Detection</span></h3>
                </div>
                <p class="test-description">Union strokes to form the letter B with proper CCW holes</p>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="letter-b-canvas" width="800" height="800"></canvas>
                    </div>
                    <div class="controls-panel">
                        <div class="controls">
                            <button class="btn btn-primary" onclick="tests.testLetterB()">Create Letter B</button>
                            <button class="btn btn-secondary" onclick="tests.resetTest('letter-b')">Reset</button>
                        </div>

                        <div class="controls">
                            <button class="btn btn-success" onclick="tests.exportSVG('letter-b', 'raw')">Export Raw</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('letter-b', 'input')">Export Input</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('letter-b', 'output')">Export Output</button>
                        </div>

                        <div id="letter-b-result" class="result">Ready to run test</div>
                        <div id="letter-b-info" class="geometry-info"></div>
                    </div>
                </div>
            </div>

            <!-- Nested Structure Test -->
            <div class="test-card" data-test="nested">
                <div class="test-header">
                    <h3 class="test-title">Nested Structure</h3>
                </div>
                <p class="test-description">Create complex nested shapes with draggable islands</p>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="nested-canvas" width="800" height="800"></canvas>
                    </div>
                    <div class="controls-panel">
                        <div class="controls">
                            <button class="btn btn-primary" onclick="tests.testNestedStructure()">Create Structure</button>
                            <button class="btn btn-secondary" onclick="tests.resetTest('nested')">Reset</button>
                        </div>

                        <div class="controls">
                            <button class="btn btn-success" onclick="tests.exportSVG('nested', 'raw')">Export Raw</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('nested', 'input')">Export Input</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('nested', 'output')">Export Output</button>
                        </div>

                        <div id="nested-result" class="result">Ready to run test</div>
                        <div id="nested-info" class="geometry-info"></div>
                    </div>
                </div>
            </div>

            <!-- PCB Trace Fusion Test -->
            <div class="test-card" data-test="pcb-fusion">
                <div class="test-header">
                    <h3 class="test-title">PCB Trace Fusion</h3>
                </div>
                <p class="test-description">Merge PCB traces and pads into unified regions with holes</p>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="pcb-fusion-canvas" width="800" height="800"></canvas>
                    </div>
                    <div class="controls-panel">
                        <div class="controls">
                            <button class="btn btn-primary" onclick="tests.testPCBFusion()">Fuse Components</button>
                            <button class="btn btn-secondary" onclick="tests.resetTest('pcb-fusion')">Reset</button>
                        </div>

                        <div class="controls">
                            <button class="btn btn-success" onclick="tests.exportSVG('pcb-fusion', 'raw')">Export Raw</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('pcb-fusion', 'input')">Export Input</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('pcb-fusion', 'output')">Export Output</button>
                        </div>

                        <div id="pcb-fusion-result" class="result">Ready to run test</div>
                        <div id="pcb-fusion-info" class="geometry-info"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Path Operations -->
        <h2 class="test-group-header">Path Operations</h2>

        <div class="test-grid">
            <!-- Offset Test -->
            <div class="test-card" data-test="offset">
                <div class="test-header">
                    <h3 class="test-title">Path Offsetting</h3>
                </div>
                <p class="test-description">Create internal and external offsets with various join types</p>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="offset-canvas" width="800" height="800"></canvas>
                    </div>
                    <div class="controls-panel">
                        <div class="controls">
                            <div class="control">
                                <label for="offset-shape">Shape:</label>
                                <select id="offset-shape">
                                    <option value="star">Star</option>
                                    <option value="circle">Circle</option>
                                    <option value="square">Square</option>
                                    <option value="triangle">Triangle</option>
                                    <option value="bottleneck">Bottleneck</option>
                                </select>
                            </div>
                            <div class="control">
                                <label for="offset-type">Type:</label>
                                <select id="offset-type">
                                    <option value="external">External</option>
                                    <option value="internal">Internal</option>
                                </select>
                            </div>
                        </div>

                        <div class="controls">
                            <div class="control">
                                <label for="offset-count">Count:</label>
                                <input type="number" id="offset-count" value="3" min="1" max="10">
                            </div>
                            <div class="control">
                                <label for="offset-distance">Distance:</label>
                                <input type="number" id="offset-distance" value="20" min="1" max="100">
                            </div>
                        </div>

                        <div class="controls">
                            <div class="control">
                                <label for="offset-join">Join Type:</label>
                                <select id="offset-join">
                                    <option value="Round">Round</option>
                                    <option value="Miter">Miter</option>
                                    <option value="Square">Square</option>
                                </select>
                            </div>
                            <div class="control">
                                <label for="offset-miter-limit">Miter Limit:</label>
                                <input type="number" id="offset-miter-limit" value="10" min="1" max="20" step="0.5">
                            </div>
                        </div>

                        <div class="controls">
                            <button class="btn btn-primary" onclick="tests.testOffset()">Apply Offset</button>
                            <button class="btn btn-secondary" onclick="tests.resetTest('offset')">Reset</button>
                        </div>

                        <div class="controls">
                            <button class="btn btn-success" onclick="tests.exportSVG('offset', 'raw')">Export Raw</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('offset', 'input')">Export Input</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('offset', 'output')">Export Output</button>
                        </div>

                        <div id="offset-result" class="result">Ready to run test</div>
                        <div id="offset-info" class="geometry-info"></div>
                    </div>
                </div>
            </div>

            <!-- Simplify Test -->
            <div class="test-card" data-test="simplify">
                <div class="test-header">
                    <h3 class="test-title">Path Simplification</h3>
                </div>
                <p class="test-description">Reduce vertices while preserving shape (using rabbit SVG)</p>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="simplify-canvas" width="800" height="800"></canvas>
                    </div>
                    <div class="controls-panel">
                        <div class="controls">
                            <div class="control">
                                <label for="simplify-tolerance">Tolerance:</label>
                                <input type="number" id="simplify-tolerance" min="0.5" max="100" value="2" step="0.5">
                            </div>
                        </div>

                        <div class="controls">
                            <button class="btn btn-primary" onclick="tests.testSimplify()">Simplify Path</button>
                            <button class="btn btn-secondary" onclick="tests.resetTest('simplify')">Reset</button>
                        </div>

                        <div class="controls">
                            <button class="btn btn-success" onclick="tests.exportSVG('simplify', 'raw')">Export Raw</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('simplify', 'input')">Export Input</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('simplify', 'output')">Export Output</button>
                        </div>

                        <div id="simplify-result" class="result">Ready to run test</div>
                        <div id="simplify-info" class="geometry-info"></div>
                    </div>
                </div>
            </div>

            <!-- Minkowski Operations Test -->
            <div class="test-card" data-test="minkowski">
                <div class="test-header">
                    <h3 class="test-title">Minkowski vs Offset<span class="badge new">Comparison</span></h3>
                </div>
                <p class="test-description">Compare Minkowski operations with standard offsets. Circle patterns produce identical results, while non-circular patterns reveal key differences.</p>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="minkowski-canvas" width="800" height="800"></canvas>
                    </div>
                    <div class="controls-panel">
                        <div class="controls">
                            <div class="control">
                                <label for="minkowski-pattern">Pattern:</label>
                                <select id="minkowski-pattern">
                                    <option value="circle">Circle (≡ offset)</option>
                                    <option value="square">Square</option>
                                    <option value="triangle">Triangle</option>
                                    <option value="star">Star</option>
                                    <option value="diamond">Diamond</option>
                                    <option value="hex">Hexagon</option>
                                </select>
                            </div>
                            <div class="control">
                                <label for="minkowski-path">Path:</label>
                                <select id="minkowski-path">
                                    <option value="line">Line</option>
                                    <option value="triangle">Triangle</option>
                                    <option value="square">Square</option>
                                    <option value="concave">Concave Shape</option>
                                    <option value="zigzag">Zigzag</option>
                                    <option value="lshape">L-Shape</option>
                                </select>
                            </div>
                        </div>

                        <div class="controls">
                            <div class="control">
                                <label for="minkowski-operation">Operation:</label>
                                <select id="minkowski-operation">
                                    <option value="sum">Sum (≈ external offset)</option>
                                    <option value="diff">Difference (≈ internal offset)</option>
                                </select>
                            </div>
                        </div>

                        <div class="controls">
                            <div class="control">
                                <label for="minkowski-sweep">
                                    <input type="checkbox" id="minkowski-sweep">
                                    Show Sweep
                                </label>
                            </div>
                            <div class="control">
                                <label for="minkowski-offset">
                                    <input type="checkbox" id="minkowski-offset">
                                    Compare with Offset
                                </label>
                            </div>
                        </div>

                        <div class="controls">
                            <button class="btn btn-primary" onclick="tests.testMinkowski()">Calculate</button>
                            <button class="btn btn-secondary" onclick="tests.resetTest('minkowski')">Reset</button>
                        </div>

                        <div class="controls">
                            <button class="btn btn-success" onclick="tests.exportSVG('minkowski', 'raw')">Export Raw</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('minkowski', 'input')">Export Input</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('minkowski', 'output')">Export Output</button>
                        </div>

                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: rgba(16, 185, 129, 0.3); border-color: #10b981;"></div>
                                <span>Minkowski Result</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: none; border: 2px dashed #f59e0b;"></div>
                                <span>Offset Result</span>
                            </div>
                        </div>

                        <div id="minkowski-result" class="result">Ready to run test</div>
                        <div id="minkowski-info" class="geometry-info"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Tools -->
        <h2 class="test-group-header">Analysis Tools</h2>

        <div class="test-grid">

            <!-- Point in Polygon Test -->
            <div class="test-card" data-test="pip">
                <div class="test-header">
                    <h3 class="test-title">Point in Polygon</h3>
                </div>
                <p class="test-description">Test if points are inside, outside, or on polygon edges</p>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="pip-canvas" width="800" height="800"></canvas>
                    </div>
                    <div class="controls-panel">
                        <div class="controls">
                            <button class="btn btn-primary" onclick="tests.checkPointLocations()">Check Locations</button>
                            <button class="btn btn-secondary" onclick="tests.resetTest('pip')">Reset</button>
                        </div>
                        <div class="control">
                            <label for="pip-tolerance">Edge Tolerance:</label>
                            <input type="number" id="pip-tolerance" value="6" min="1" max="40" step="1">
                            <span>px</span>
                        </div>

                        <div class="controls">
                            <button class="btn btn-success" onclick="tests.exportSVG('pip', 'raw')">Export Raw</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('pip', 'input')">Export Input</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('pip', 'output')">Export Output</button>
                        </div>

                        <div id="pip-result" class="result">Click to add test points</div>
                        <div id="pip-info" class="geometry-info"></div>
                    </div>
                </div>
            </div>

            <!-- Area Test -->
            <div class="test-card" data-test="area">
                <div class="test-header">
                    <h3 class="test-title">Area Calculation</h3>
                </div>
                <p class="test-description">Draw a polygon and calculate its area and winding direction</p>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="area-canvas" width="800" height="800"></canvas>
                    </div>
                    <div class="controls-panel">
                        <div class="controls">
                            <button class="btn btn-primary" onclick="tests.calculateArea()">Calculate Area</button>
                            <button class="btn btn-secondary" onclick="tests.resetTest('area')">Reset</button>
                        </div>

                        <div class="controls">
                            <button class="btn btn-success" onclick="tests.exportSVG('area', 'raw')">Export Raw</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('area', 'input')">Export Input</button>
                            <button class="btn btn-success" onclick="tests.exportSVG('area', 'output')">Export Output</button>
                        </div>

                        <div id="area-result" class="result">Click points to draw polygon (min 3)</div>
                        <div id="area-info" class="geometry-info"></div>
                    </div>
                </div>
            </div>

            <!-- Arc Reconstruction Test -->
            <div class="test-card" data-test="arc-reconstruction">
                <div class="test-header">
                    <h3 class="test-title">Arc Reconstruction<span class="badge new">Metadata</span></h3>
                </div>
                <p class="test-description">Demonstrates metadata preservation through boolean operations and reconstruction of analytic curves from tessellated results</p>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="arc-reconstruction-canvas" width="800" height="800"></canvas>
                    </div>
                    <div class="controls-panel">
                        <div class="controls">
                            <div class="control">
                                <label for="arc-operation">Operation:</label>
                                <select id="arc-operation">
                                    <option value="union">Union</option>
                                    <option value="intersection">Intersection</option>
                                    <option value="difference">Difference</option>
                                    <option value="xor">XOR</option>
                                </select>
                            </div>
                            <div class="control">
                                <label for="arc-reconstruct-toggle">
                                    <input type="checkbox" id="arc-reconstruct-toggle" checked>
                                    Show Reconstruction
                                </label>
                            </div>
                            <div class="control">
                                <label for="arc-show-metadata">
                                    <input type="checkbox" id="arc-show-metadata">
                                    Show Metadata
                                </label>
                            </div>
                        </div>

                        <div class="controls">
                            <button class="btn btn-primary" onclick="tests.testArcReconstruction()">Run Test</button>
                            <button class="btn btn-secondary" onclick="tests.resetTest('arc-reconstruction')">Reset</button>
                        </div>

                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: rgba(59, 130, 246, 0.2); border-color: #3b82f6;"></div>
                                <span>Polygonal Result</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: none; border: 3px solid #ff9900;"></div>
                                <span>Reconstructed Arc</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #00ff00; width: 8px; height: 8px; border-radius: 50%;"></div>
                                <span>Arc Start</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #ff0000; width: 8px; height: 8px; border-radius: 50%;"></div>
                                <span>Arc End</span>
                            </div>
                        </div>

                        <div id="arc-reconstruction-result" class="result">Ready to run test</div>
                        <div id="arc-reconstruction-info" class="geometry-info"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-card">
            <h3>Additional Clipper2 Functions</h3>
            <p>
                The Clipper2 WASM wrapper also provides access to advanced functions not demonstrated in these interactive tests:
            </p>
            <ul>
                <li><strong>PolyTree/PolyPath structures:</strong> Hierarchical polygon representation with parent-child relationships, essential for complex nested geometries.</li>
                <li><strong>TrimCollinear:</strong> Optimization tool to remove redundant vertices on straight segments.</li>
                <li><strong>RectClip operations:</strong> Extremely fast O(n) rectangular clipping for axis-aligned regions (viewport culling).</li>
            </ul>
            <p>
                These features are native to the <a href="https://github.com/AngusJohnson/Clipper2" target="_blank">Clipper2</a> library and fully exposed by the wrapper. 
                Refer to the <a href="https://github.com/ErikSom/Clipper2-WASM/" target="_blank">Clipper2-WASM documentation</a> for more API detail.
            </p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <p>EasyTrace5000 Clipper2 Test Suite &copy; 2025 Eltryus.</p>
    </footer>

    <!-- Loading indicator -->
    <div id="loading" class="loading active">
        <div class="spinner"></div>
    </div>

    <!-- Scripts -->
    <script src="clipper2z.js"></script>
    <script src="clipper2-defaults.js"></script>
    <script src="clipper2-svg-exporter.js"></script>
    <script src="clipper2-core.js"></script>
    <script src="clipper2-geometry.js"></script>
    <script src="clipper2-operations.js"></script>
    <script src="clipper2-rendering.js"></script>
    <script src="clipper2-arc-reconstruction.js"></script>
    <script src="clipper2-tests.js"></script>
    <script src="clipper2-ui.js"></script>
    <script>
        // Global test instance
        let tests = null;
        let ui = null;

        // Initialize on page load
        async function initializeApp() {
            try {
                // Create test system
                tests = new Clipper2Tests();
                await tests.initialize();

                // Initialize operations and geometry with defaults
                tests.operations.initialize(Clipper2Defaults);
                tests.geometry.initialize(Clipper2Defaults);
                tests.rendering.initialize(Clipper2Defaults);

                // Create and initialize UI
                ui = new Clipper2UI(tests);
                await ui.initialize();

                console.log('[APP] Initialization complete');

            } catch (error) {
                console.error('[APP] Failed to initialize:', error);
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.innerHTML = `
                        <div style="color: #ef4444; text-align: center; padding: 2rem;">
                            <h2>⚠️ Initialization Error</h2>
                            <p>${error.message}</p>
                            <button onclick="location.reload()" class="btn btn-primary">
                                Reload Page
                            </button>
                        </div>
                    `;
                }
            }
        }

        // Start initialization when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>